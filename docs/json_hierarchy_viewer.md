# JSON Hierarchy Viewer 仕様書

## 概要

JSON Hierarchy Viewerは、JSONの階層構造を美しく表示し、階層単位でのコピーが可能なWebベースツールです。個別の値だけでなく、キーをクリックすることでその階層全体をコピーできる点が特徴です。

## ファイル情報

- **ファイル名**: `json-hierarchy-viewer.html`
- **タイトル**: "JSON Hierarchy Viewer"
- **言語**: HTML, CSS, JavaScript (Vanilla)

## 機能仕様

### 1. 入力機能

#### JSONテキストエリア
- **目的**: JSONデータの入力
- **プレースホルダー**: "JSONを入力してください..."
- **属性**: リサイズ可能（垂直方向のみ）
- **フォント**: Consolas, Monaco, Courier New (monospace)
- **最小高さ**: 150px

### 2. 操作ボタン

#### 整形表示
- **機能**: JSONを階層構造で表示
- **キーボードショートカット**: `Ctrl + Enter`
- **エラーハンドリング**: 無効なJSON形式の場合はエラーメッセージを表示

#### 全体をコピー
- **機能**: 元のJSON全体をクリップボードにコピー
- **条件**: 整形処理が完了している場合のみ有効
- **フィードバック**: コピー成功時にツールチップ表示

#### クリア
- **機能**: 入力エリア、結果表示、エラーメッセージをすべてクリア
- **色**: 赤色（警告色）

### 3. 階層表示機能

#### シンタックスハイライト
- **キー**: 赤色 (`#d73a49`)、太字
- **文字列値**: 青色 (`#032f62`)
- **数値**: 青色 (`#005cc5`)
- **ブール値**: オレンジ色 (`#e36209`)
- **null値**: 紫色 (`#6f42c1`)
- **括弧・カンマ**: グレー (`#6a737d`)、太字

#### インデント表示
- **インデント幅**: 2スペース
- **階層表示**: ネストレベルに応じた視覚的インデント
- **改行**: オブジェクトと配列の各要素で改行

### 4. インタラクティブ機能

#### 値クリックコピー
- **対象**: 文字列、数値、ブール値、null値
- **動作**: 値そのものをクリップボードにコピー
- **表示**: ホバー時に背景色変化
- **フィードバック**: クリック位置にツールチップ表示

#### キークリックコピー（階層コピー）
- **対象**: オブジェクトのキー
- **動作**: そのキーに対応する値全体（オブジェクトや配列）をJSON形式でコピー
- **特徴**: 複雑な階層データを一括コピー可能
- **表示**: ホバー時に背景色変化（薄いピンク）

#### ホバーエフェクト
- **値要素**: 薄い青色背景 (`#e3f2fd`)
- **キー要素**: 薄いピンク色背景 (`#ffe8e8`)
- **アクション時**: より濃い色に変化

### 5. データ処理

#### JSON解析
- **ライブラリ**: ネイティブ `JSON.parse()`
- **エラーハンドリング**: try-catch でエラーをキャッチ
- **検証**: 解析前に入力値の存在チェック

#### DOM生成アルゴリズム
```javascript
function createInteractiveJSON(data, indent = '') {
    // 再帰的にDOM要素を生成
    // データ型に応じてスタイルを適用
    // クリックイベントリスナーを追加
}
```

### 6. エラーハンドリング

#### JSON解析エラー
- **表示**: 赤色の背景でエラーメッセージを表示
- **内容**: "無効なJSON形式です: [詳細エラー]"

#### クリップボードエラー
- **表示**: エラーメッセージで通知
- **内容**: "クリップボードへのコピーに失敗しました"

## UI/UXデザイン

### レイアウト
- **最大幅**: 1200px
- **中央配置**: margin auto
- **背景色**: グレー (`#f5f5f5`)
- **コンテナ**: 白背景、角丸、シャドウ付き

### ヘッダー
- **背景色**: ライトグレー (`#e9ecef`)
- **タイトル**: "JSON Hierarchy Viewer"
- **ナビゲーション**: "← メニューに戻る" リンク
- **位置**: 右寄せ

### JSON表示エリア
- **背景色**: ライトグレー (`#f8f9fa`)
- **パディング**: 20px
- **フォント**: モノスペース
- **行間**: 1.6
- **オーバーフロー**: 横スクロール対応

### フッター
- **内容**: "Copyright 2025 goodsun all rights reserved"
- **リンク**: GitHubリポジトリへのリンク
- **位置**: 中央配置

## 技術実装

### DOM操作

#### 要素生成
```javascript
function createClickableSpan(text, className, actualValue, isComplexValue = false) {
    const span = document.createElement('span');
    span.className = className;
    span.textContent = text;
    
    span.addEventListener('click', async function(e) {
        // クリップボードにコピー
        let copyValue = isComplexValue ? 
            JSON.stringify(actualValue, null, 2) : 
            String(actualValue);
        await navigator.clipboard.writeText(copyValue);
    });
    
    return span;
}
```

#### イベント処理
- **クリックイベント**: 非同期でクリップボードAPI呼び出し
- **エラー処理**: try-catch でClipboard APIエラーをハンドル
- **フィードバック**: ツールチップの位置計算と表示

### パフォーマンス

#### 最適化要素
- **DOM生成**: 一度に全体を生成後、一括でDOMに追加
- **イベントリスナー**: 各要素に個別にアタッチ
- **メモリ管理**: 大きなJSONオブジェクトの処理を考慮

#### スケーラビリティ
- **大きなJSON**: メモリ使用量に注意
- **深いネスト**: 再帰処理の深度制限なし
- **多数の要素**: イベントリスナーの数に比例

## ブラウザ対応

### 必須要件
- **JavaScript**: ES6+ 対応
- **Clipboard API**: コピー機能のため
- **DOM API**: 動的要素生成のため

### 対応ブラウザ
- Chrome 63+
- Firefox 53+
- Safari 13.1+
- Edge 79+

## 使用例

### 基本的な使用方法
1. JSONデータを入力エリアに貼り付け
2. 「整形表示」ボタンをクリック
3. 個別の値をクリックして値のみをコピー
4. キーをクリックして階層全体をコピー

### 階層コピーの例
```json
{
    "user": {
        "name": "田中太郎",
        "age": 30,
        "address": {
            "zip": "100-0001",
            "city": "東京都千代田区"
        }
    }
}
```

- `"name"`をクリック → `"田中太郎"`をコピー
- `"user"`をクリック → `user`オブジェクト全体をJSONでコピー
- `"address"`をクリック → `address`オブジェクト全体をJSONでコピー

### 想定ユースケース
- **API レスポンス解析**: 複雑な階層データの確認
- **設定ファイル編集**: 特定の設定ブロックの抽出
- **データ移行**: 部分的なデータの取得・移動
- **デバッグ作業**: 特定の階層データの確認

## JSON Formatter との違い

### JSON Formatter
- **焦点**: JSONの整形・加工（ソート、空白値除去）
- **コピー**: 加工後の値をコピー
- **用途**: データクリーニング、整理

### JSON Hierarchy Viewer
- **焦点**: 階層構造の可視化
- **コピー**: 元の構造を保持した階層単位でのコピー
- **用途**: データ解析、部分抽出

## 制約事項

### 処理制限
- **ファイルサイズ**: ブラウザのメモリ制限に依存
- **JSONサイズ**: 大きなJSONは処理時間が増加
- **ネスト深度**: 極端に深いネストは処理が遅くなる可能性

### セキュリティ
- **XSS対策**: textContentを使用してHTMLエスケープ
- **CSP準拠**: インラインスクリプトなし
- **データ保護**: ローカル処理のみ、外部送信なし

## 保守・拡張性

### 今後の拡張可能性
- **折りたたみ機能**: 大きなオブジェクト・配列の折りたたみ
- **検索機能**: 特定のキーや値の検索・ハイライト
- **パス表示**: 現在の階層パスの表示
- **フィルター機能**: 特定の条件に一致する要素のみ表示
- **比較機能**: 複数のJSONの差分表示